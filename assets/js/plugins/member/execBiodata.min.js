/*** INI EXEC BIODATA */
(function($) {
    $.fn.execBiodata = function() {
        $.execBiodata(this);
    };
    $.execBiodata = function(prop) {
        let _this = $(prop),
            param = {
                id : $('#pribadi').val(),
                form : 'biodata',
                token : $.sessionHandler().get('token'),
            },
            apprv = true,
            forms = {};
        // mulai ekseskusi form
        _this.ajaxButton('load');
        $.formBiodata('forms','kabupaten','kecamatan').forEach((item)=>{
            let input = $('input[name='+item+'], select[name='+item+'], textarea[name='+item+']').val();
            forms[item] = input;
        })
        param = $.extend(param,forms);
        // filter inputan wajib
        $.formBiodata('form').wajib.forEach((item)=>{
            let input = $('input[name='+item+'], select[name='+item+'], textarea[name='+item+']'),
                label = input.siblings('small');

            if(!input.val()){
                label.addClass('text-danger').text(label.data('text') + ' wajib diisi!');   
                apprv = false;             
            }else{
                if(item==='nik' && (input.val().length < 16 || input.val().length > 16)){
                    label.addClass('text-danger').text('NIK terdapat 16 angka!');
                    apprv = false;
                }
            }
            
        });       

        if(!apprv){
            $.simpleAlert({
                title: 'Form belum lengkap',
                message: 'Check kembali form wajib isi!',
                type: 'warning',
                timeOut: 1500
            });
            _this.ajaxButton('stop');
            return false;
        }

        $.post("biodata", param).done(function(response) {
            console.log(response);
            $.simpleAlert({
                title: 'Sukses',
                message: response.messeges,
                type: 'success',
                timeOut: 1500
            });
            if(response.result.id > 0){
                $('#pribadi').val(response.result.id),
                $('html, body').animate({scrollTop: '0px'}, 200),
                $('#keperluan').focus(),
                $('#btnProses .text').text('Update Data');
            }
        }).always(function() {
            _this.ajaxButton('stop');
        });
            
    };
})(jQuery);