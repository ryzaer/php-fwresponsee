(function ($) {
    $.fn.simplePaginate = function (optionsOrMethod) {
        if (typeof optionsOrMethod === 'string') {
            const method = optionsOrMethod;
            const args = Array.prototype.slice.call(arguments, 1);
            const instance = this.data('simplePaginate');

            if (instance && typeof instance[method] === 'function') {
                return instance[method].apply(instance, args);
            }
            return this;
        }

        const settings = $.extend({
            data: [],
            rowsPerPage: 5,
            currentPage: 1,
            columns: [], // akan digunakan jika renderRow tidak disediakan
            renderRow: null, // fungsi custom render <tr>
            onSuccess: function () { }
        }, optionsOrMethod);

        const table = this;
        const pagination = $('<div class="align-content-center simple-pg"></div>').insertAfter(table);
        let currentPage = settings.currentPage;

        function renderPage(page) {
            const startIndex = (page - 1) * settings.rowsPerPage;
            const endIndex = startIndex + settings.rowsPerPage;
            const pageData = settings.data.slice(startIndex, endIndex);

            let tbody = table.find("tbody");
            if (tbody.length === 0) {
                tbody = $("<tbody></tbody>").appendTo(table);
            }

            tbody.empty();

            pageData.forEach((rowData, i) => {
                let row;
                if (typeof settings.renderRow === 'function') {
                    // Jika disediakan renderRow
                    row = settings.renderRow.call(table, rowData, startIndex + i);
                } else {
                    // Default render jika tidak ada renderRow
                    row = $("<tr></tr>");
                    settings.columns.forEach(column => {
                        row.append(`<td>${rowData[column]}</td>`);
                    });
                }
                tbody.append(row);
            });

            settings.onSuccess.call(table, pageData);
        }

        function renderPagination() {
            const totalPages = Math.ceil(settings.data.length / settings.rowsPerPage);
            pagination.empty();

            if (settings.data.length <= settings.rowsPerPage) {
                pagination.hide();
            } else {
                pagination.show();
                for (let i = 1; i <= totalPages; i++) {
                    const button = $(`<button data-page="${i}">${i}</button>`);
                    if (i === currentPage) button.addClass("active");
                    pagination.append(button);
                }
            }
        }

        pagination.on("click", "button", function () {
            currentPage = parseInt($(this).attr("data-page"));
            renderPage(currentPage);
            renderPagination();
        });

        this.data('simplePaginate', {
            updateData: function (newData, newPage) {
                settings.data = newData;

                if (typeof newPage !== 'undefined' && !isNaN(newPage)) {
                    currentPage = newPage;
                }

                const totalPages = Math.ceil(settings.data.length / settings.rowsPerPage);
                if (currentPage > totalPages) {
                    currentPage = totalPages > 0 ? totalPages : 1;
                }

                renderPage(currentPage);
                renderPagination();
            },
            destroy: function () {
                pagination.remove();
                table.find('tbody').remove();
                table.removeData('simplePaginate');
            }
        });

        renderPage(currentPage);
        renderPagination();

        return this;
    }
})(jQuery);